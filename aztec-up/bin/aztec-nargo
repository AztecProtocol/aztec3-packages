#!/usr/bin/env bash
set -euo pipefail

# export SKIP_NET=1
# export SKIP_PORT_ASSIGNMENT=1
# export PATH=$PATH:$HOME/bin

# if [ "${1:-}" == "lsp" ]; then
#   docker run -i -v $HOME:$HOME -e HOME=$HOME --entrypoint /usr/src/noir/noir-repo/target/release/nargo \
#     aztecprotocol/aztec $@
# else
#   ENTRYPOINT=/usr/src/noir/noir-repo/target/release/nargo $(dirname $0)/.aztec-run $@
# fi

if [[ $PWD != ${HOME}* ]]; then
  echo "Due to how we containerize our applications, we require your working directory to be somewhere within $HOME."
  exit 1
fi

if [ -t 0 ]; then
  if [ -t 1 ]; then
    args="-ti"
  else
    args="-i"
  fi
fi

docker run ${args:-} \
  -v $HOME:$HOME \
  -e HOME=$HOME \
  --workdir="$PWD" \
  --entrypoint /usr/src/aztec-nargo/compile_then_postprocess.sh \
  aztecprotocol/aztec "$@"
